include: gitlab-ci-automation-template.yml

stages:
  - test

before_script:
  - export GRADLE_USER_HOME=cache/.gradle

cache:
  paths:
    - $GRADLE_USER_HOME/caches/
    - $GRADLE_USER_HOME/wrapper/
    - $GRADLE_USER_HOME/build-cache/

run_user:
  stage: test
  variables:
    TAGS_EXPRESSION: '@User'
    CUSTOM_PATH_ONE: "**/user/**/*"
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "**/user/**/*"
        - ".gitlab-ci.yml"
  artifacts:
    when: always
    paths:
      - ./target/site/serenity
    expire_in: 1 week


run_store:
  stage: test
  variables:
    TAGS_EXPRESSION: '@Store'
    CUSTOM_PATH_ONE: "**/store/**/*"
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "**/store/**/*"


run_pet:
  stage: test
  variables:
    TAGS_EXPRESSION: '@Pet'
    CUSTOM_PATH_ONE: "**/pet/**/*"
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "**/pet/**/*"
