before_script:
  - export GRADLE_USER_HOME=cache/.gradle

cache:
  paths:
    - $GRADLE_USER_HOME/caches/
    - $GRADLE_USER_HOME/wrapper/
    - $GRADLE_USER_HOME/build-cache/


stages:
  - test

run_user:
  stage: test
  image: gradle:6.8.3-jdk15-openj9
  variables:
    TAGS_EXPRESSION: '@User'
  script:
    - echo "gradle my test -Dcucumber.filter.tags=@$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="@$TAGS_EXPRESSION"
  rules:
    changes:
      - "**/user/**/*"
      - ".gitlab-ci.yml"
  artifacts:
    when: always
    paths:
      - ./target/site/serenity
    expire_in: 1 week

run_store:
  stage: test
  image: gradle:6.8.3-jdk15-openj9
  variables:
    TAGS_EXPRESSION: '@Store'
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    changes:
      - "**/store/**/*"
  artifacts:
    when: always
    paths:
      - ./target/site/serenity
    expire_in: 1 week

run_pet:
  stage: test
  image: gradle:6.8.3-jdk15-openj9
  variables:
    TAGS_EXPRESSION: '@Pet'
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    changes:
      - "**/pet/**/*"
  artifacts:
    when: always
    paths:
      - ./target/site/serenity
    expire_in: 1 week