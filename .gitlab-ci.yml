stages:
  - test

before_script:
  - export GRADLE_USER_HOME=cache/.gradle


cache:
  paths:
    - $GRADLE_USER_HOME/caches/
    - $GRADLE_USER_HOME/wrapper/
    - $GRADLE_USER_HOME/build-cache/

run_user:
  stage: test
  image: gradle:6.8.3-jdk15-openj9
  variables:
    TAGS_EXPRESSION: '@User'
  script:
    - echo "gradle my test -Dcucumber.filter.tags=@$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="@$TAGS_EXPRESSION"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "**/user/**/*"
        - ".gitlab-ci.yml"
  artifacts:
    when: always
    paths:
      - ./target/site/serenity
    expire_in: 1 week


run_store:
  stage: test
  image: gradle:6.8.3-jdk15-openj9
  variables:
    TAGS_EXPRESSION: '@Store'
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "**/store/**/*"


run_pet:
  stage: test
  image: gradle:6.8.3-jdk15-openj9
  variables:
    TAGS_EXPRESSION: '@Pet'
  script:
    - echo "gradle my test -Dcucumber.filter.tags=$TAGS_EXPRESSION"
    - gradle test -Dcucumber.filter.tags="$TAGS_EXPRESSION"
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: on_success
    - if: '$CI_PIPELINE_SOURCE == "push"'
      changes:
        - "**/pet/**/*"
